var uploaderObject=function(b){var a=this;if(!b.key||!b.url){a.lastError={code:1,text:"Not image"};b.oncomplete.call(a,false)}this.xhr=new XMLHttpRequest();this.reader=new FileReader();this.progress=0;this.uploaded=false;this.successful=false;this.lastError=false;a.reader.onload=function(){a.xhr.upload.addEventListener("progress",function(d){if(d.lengthComputable){a.progress=(d.loaded*100)/d.total;if(b.onprogress instanceof Function){b.onprogress.call(a,Math.round(a.progress))}}},false);a.xhr.upload.addEventListener("load",function(){a.progress=100;a.uploaded=true},false);a.xhr.upload.addEventListener("error",function(){a.lastError={code:1,text:"Error uploading on server"}},false);a.xhr.onreadystatechange=function(){var d=b.oncomplete instanceof Function;if(this.readyState==4){if(this.status==200){if(!a.uploaded){if(d){b.oncomplete.call(a,false)}}else{a.successful=true;if(d){b.oncomplete.call(a,true,JSON.parse(this.responseText))}}}else{a.lastError={code:this.status,text:"HTTP response code is not OK ("+this.status+")"};if(d){b.oncomplete.call(a,false)}}}};a.xhr.open("POST",b.url);var c=new FormData();c.append("q",b.q);c.append("name",b.name);c.append("email",b.email);c.append("title",b.title);c.append("tags",b.tags);c.append("key",b.key);c.append("text",b.text);c.append("video",typeof(b.video)!="undefined"?b.video:"");c.append("sort",b.sort);c.append("file",b.file);a.xhr.send(c)};a.reader.readAsArrayBuffer(b.file)};